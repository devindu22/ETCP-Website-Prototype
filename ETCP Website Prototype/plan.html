<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan your Trip | ETCP</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <!-- Poppins Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Local favicon path -->
    <link rel="icon" href="img/favicon_io/favicon.ico" type="image/x-icon">

    <style>
        /* Define custom CSS variables */
        :root {
            --primary-green: #28a745;
            --gradient-start: #28a745;
            --gradient-end: #00e6ac;
            --navbar-bg: #28a745;
            --hover-green: #218838;
            --footer-bg: #f5f5f5;
            --footer-text: #555;
            --text-dark-grey: #374151; /* Similar to Tailwind's gray-800 */
            --text-medium-grey: #4b5563; /* Similar to Tailwind's gray-600 */
            --text-light-grey: #6b7280; /* Similar to Tailwind's gray-500 */
            --light-bg-grey: #f0f2f5; /* Light grey background for the whole page */
            --border-light-grey: #e0e0e0; /* Border color for sections */
            --green-tint-bg: #d1fae5; /* Light green tint for offers card */
            --green-active: #10b981; /* Main active green for pills/buttons */
            --green-active-dark: #059669; /* Darker active green */
            --highlight-blue: #007bff; /* For the missing blue bar - now green */
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--light-bg-grey);
            color: var(--text-dark-grey);
            padding-top: 70px; /* For fixed navbar */
            overflow-x: hidden; /* Prevent horizontal scroll */
            margin: 0;
            padding-bottom: 2rem; /* Space before footer */
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        /* ===== Navbar ===== */
        .navbar {
            background-color: var(--navbar-bg);
            transition: padding 0.3s ease;
            padding: 1rem 1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .navbar.navbar-shrink {
            padding: 0.25rem 1rem;
        }

        .navbar .navbar-brand img {
            height: 40px;
        }

        .nav-link {
            color: white !important;
            position: relative;
            padding: 0.5rem 0.75rem;
            transition: color 0.2s ease;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
        }

        .nav-link::after {
            content: "";
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: white;
            transition: width 0.3s ease;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .nav-link:hover {
            color: #e0e0e0 !important;
        }

        .nav-link.active {
            font-weight: 600;
            color: aqua !important; /* Highlight active link */
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); /* Subtle glow effect */
        }

        .navbar-toggler-icon {
            filter: invert(1);
        }

        /* Header Section */
        .header-section-content {
            background: linear-gradient(to bottom, var(--navbar-bg), rgba(255, 255, 255, 0) 40%, #fff 80%);
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        .header-section-content .container {
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        .header-section-content h1 {
            text-align: left; /* Explicitly align heading to left */
            margin-bottom: 1.5rem; /* Increased margin for spacing */
            padding-left: 1rem; /* Align with container content */
            padding-right: 1rem; /* Align with container content */
            font: 10em sans-serif;
            /* Animation for the heading */
            opacity: 0; /* Start invisible */
            transform: translateY(20px); /* Start slightly below */
            animation: fadeInUp 1s ease-out forwards; /* Apply animation */
        }

        /* Keyframe animation for fade-in and slide-up */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Main Search Pill */
        .main-search-pill-container {
            width: 100%; /* Stretch to full width of parent container */
            margin: 0 auto 2rem auto; /* Removed negative margin, added bottom margin */
            background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end));
            border-radius: 2rem;
            padding: 0.75rem 1rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        .main-search-pill-item {
            flex-grow: 1;
            min-width: 160px; /* Base min-width for all pill items */
            display: flex;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 2rem;
            padding: 0.5rem 1rem;
            color: var(--text-dark-grey);
            font-weight: 500;
            height: 48px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        /* Specific min-width for guests pill to ensure text fits without wrapping */
        .main-search-pill-item.guest-popover-container {
            min-width: 210px; /* Adjusted min-width */
        }
        #adultsChildrenDisplay {
            white-space: nowrap; /* Prevent text wrapping */
        }
        .main-search-pill-item i {
            margin-right: 0.5rem;
            color: var(--primary-green);
        }
        .main-search-pill-item input {
            background: none;
            border: none;
            outline: none;
            color: inherit;
            font-weight: inherit;
            padding: 0;
            margin: 0;
            flex-grow: 1;
        }
        .main-search-pill-item input::placeholder {
            color: var(--text-light-grey);
        }
        .main-search-pill-item input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.5) sepia(1) saturate(5) hue-rotate(80deg);
            cursor: pointer;
        }

        /* Guest Popover Styling */
        .guest-popover-container {
            position: relative;
        }
        .guest-popover {
            position: absolute;
            background-color: #fff;
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            top: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: none;
            min-width: 200px;
            border: 1px solid var(--border-light-grey);
        }
        .guest-popover.show {
            display: block;
            animation: fadeInScale 0.2s ease-out;
        }

        /* Search Button in Main Pill */
        .btn-main-search {
            background-color: #fff;
            color: var(--primary-green);
            padding: 0.5rem 1.5rem;
            border-radius: 2rem;
            font-weight: 600;
            border: none;
            height: 48px;
            transition: background-color 0.2s ease, color 0.2s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }
        .btn-main-search:hover {
            background-color: var(--hover-green);
            color: white;
        }

        /* Entire Home Checkbox Alignment */
        .entire-home-checkbox-container {
            max-width: 1200px; /* Match container width */
            margin: 0 auto; /* Center it */
            padding: 0 1rem; /* Match container's padding-x */
            text-align: left;
            margin-top: 1rem; /* Space from search pill */
            font-size: 0.9rem;
            color: var(--text-medium-grey);
        }
        .entire-home-checkbox-container input[type="checkbox"] {
            margin-right: 0.5rem;
            transform: scale(1.1); /* Slightly larger checkbox */
            accent-color: var(--primary-green); /* Green checkbox */
        }


        /* Filter Section Styling */
        .filter-section {
            background-color: #fff;
            border-radius: 1.5rem;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-light-grey);
            overflow: hidden;
        }
        .filter-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
            margin-bottom: 0.75rem;
        }
        .filter-section-header h3 {
            font-weight: 600;
            font-size: 1.125rem;
            color: #1f2937;
        }
        .filter-section-header i {
            transition: transform 0.3s ease;
            color: var(--primary-green);
        }
        .filter-section.collapsed .filter-section-header i {
            transform: rotate(180deg);
        }
        .filter-content {
            max-height: 500px;
            transition: max-height 0.4s ease-in-out, padding-top 0.4s ease-in-out, padding-bottom 0.4s ease-in-out;
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
        }
        .filter-section.collapsed .filter-content {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            overflow: hidden;
        }

        /* Custom Checkbox and Radio styling */
        .custom-checkbox, .custom-radio {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .custom-checkbox input[type="checkbox"],
        .custom-radio input[type="radio"] {
            appearance: none;
            -webkit-appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #9ca3af;
            border-radius: 0.25rem;
            margin-right: 0.75rem;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
            transition: all 0.2s ease-in-out;
        }
        .custom-radio input[type="radio"] {
            border-radius: 9999px;
        }
        .custom-checkbox input[type="checkbox"]:checked,
        .custom-radio input[type="radio"]:checked {
            background-color: var(--green-active);
            border-color: var(--green-active);
        }
        .custom-checkbox input[type="checkbox"]:checked::after {
            content: "\2713";
            color: white;
            font-size: 0.8rem;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .custom-radio input[type="radio"]:checked::after {
            content: "";
            width: 0.6rem;
            height: 0.6rem;
            background-color: white;
            border-radius: 9999px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .custom-checkbox label,
        .custom-radio label {
            cursor: pointer;
            color: var(--text-medium-grey);
            font-size: 0.95rem;
        }

        /* Rating stars in filter */
        .filter-section .rating-stars i {
            color: #fbbf24;
            margin-right: 0.1rem;
        }
        .filter-section hr {
            margin: 0.75rem 0;
            border-color: #e5e7eb;
            opacity: 1;
        }

        /* Quantity Selector */
        .quantity-selector {
            display: flex;
            align-items: center;
            border: 1px solid #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
            width: fit-content;
            margin-bottom: 0.5rem;
        }
        .quantity-selector button {
            background-color: #f3f4f6;
            color: var(--text-medium-grey);
            padding: 0.25rem 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .quantity-selector button:hover {
            background-color: #e5e7eb;
        }
        .quantity-selector .quantity-display {
            padding: 0.25rem 0.75rem;
            min-width: 2rem;
            text-align: center;
            font-weight: 500;
            color: #1f2937;
        }

        /* Budget Slider - Adjusted for two handles */
        #budgetSliderContainer {
            position: relative;
            height: 2.5rem; /* Space for labels and track */
            padding: 0 0.5rem;
            margin-top: 1rem;
        }
        .budget-slider-track {
            position: absolute;
            width: calc(100% - 1rem);
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            top: 50%;
            transform: translateY(-50%);
            left: 0.5rem;
        }
        .form-range {
            position: absolute;
            width: calc(100% - 1rem);
            height: 1.5rem; /* clickable area */
            background: transparent;
            pointer-events: auto;
            top: 50%;
            transform: translateY(-50%);
            left: 0.5rem;
            z-index: 2; /* Ensure sliders are on top */
        }
        .form-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            background: var(--primary-green);
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            margin-top: -5px; /* Adjust thumb vertical position */
            pointer-events: all; /* Make thumb clickable */
        }
        .form-range::-moz-range-thumb {
            width: 1.25rem;
            height: 1.25rem;
            background: var(--primary-green);
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            pointer-events: all;
        }
        /* Style for the filled part of the track */
        .form-range::-webkit-slider-runnable-track {
            background: transparent; /* Track controlled by .budget-slider-track-filled */
        }
        .form-range::-moz-range-track {
            background: transparent; /* Track controlled by .budget-slider-track-filled */
        }

        .budget-slider-track-filled {
            position: absolute;
            height: 6px;
            background: var(--primary-green);
            border-radius: 3px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1; /* Below thumbs, above base track */
        }

        /* List/Grid View Toggle */
        #viewToggle {
            position: relative;
            display: inline-flex;
            background: rgba(40,167,69,0.1);
            border-radius: 2rem;
            padding: 4px;
            user-select: none;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        #viewToggle .slider {
            position: absolute;
            top: 4px;
            left: 4px;
            width: calc(50% - 8px);
            height: calc(100% - 8px);
            background: var(--primary-green);
            border-radius: 2rem;
            transition: left 0.3s ease;
            z-index: 0;
        }
        #viewToggle button {
            position: relative;
            z-index: 1;
            flex: 1;
            padding: 0.5rem 1.25rem;
            background: transparent;
            border: none;
            font-size: 1rem;
            font-weight: 500;
            color: var(--primary-green);
            cursor: pointer;
            transition: color 0.3s;
        }
        #viewToggle button.active {
            color: #fff;
        }
        #viewToggle.grid-active .slider {
            left: calc(50% + 4px);
        }

        /* Sort by dropdown */
        .sort-dropdown .dropdown-toggle {
            background-color: #fff;
            border: 1px solid var(--primary-green);
            color: var(--primary-green);
            border-radius: 2rem;
            padding: 0.5rem 1rem;
            font-weight: 500;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .sort-dropdown .dropdown-toggle:hover {
            background-color: var(--primary-green);
            color: white;
        }
        .sort-dropdown .dropdown-toggle::after {
            margin-left: .5rem;
        }
        .sort-dropdown .dropdown-menu {
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,.1);
        }
        .sort-dropdown .dropdown-item {
            color: #333;
            font-size: 0.95rem;
        }
        .sort-dropdown .dropdown-item:hover {
            background-color: var(--light-bg-grey);
            color: var(--primary-green);
        }

        .results-container {
            /* Add some spacing for better visual separation from filters */
            padding-top: 1rem;
        }

        .result-card {
            box-shadow: 0 4px 12px rgba(40,167,69,0.15);
            border-radius: 1rem;
            overflow: hidden;
            margin-bottom: 1.5rem;
            position: relative; /* Crucial for absolute positioning of rating badge */
            transition: transform .2s ease, box-shadow .2s ease;
            background-color: #fff;
            min-height: 250px; /* Standard minimum height for all cards */
        }
        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(40,167,69,0.25);
        }

        /* Wishlist button (formerly fav-btn) */
        .wishlist-btn {
            position: absolute;
            background: rgba(255,255,255,0.8); border: none;
            border-radius: 80%; width: 2.5rem; height: 2.5rem;
            display: flex; align-items: center; justify-content: center;
            color: #ccc; /* Default grey for empty */
            font-size: 1.5rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: color 0.2s, background-color 0.2s;
            z-index: 10;
        }
        .wishlist-btn:hover { background: #fff; }
        .wishlist-btn.added-to-wishlist {
            color: var(--primary-green); /* Green when added */
        }

        /* See availability button */
        .btn-see {
            background: linear-gradient(90deg,var(--gradient-start),var(--gradient-end));
            color: #fff; border: none;
            border-radius: 2rem;
            padding: .5rem 1rem; /* Reduced padding */
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform .2s;
            font-weight: 500;
            white-space: nowrap; /* Prevent text wrapping */
            display: inline-flex; /* Ensure icon and text are inline */
            align-items: center;
            gap: 0.5rem;
        }
        .btn-see:hover { transform: translateY(-2px); }

        /* Deal badge */
        .badge-deal {
            background: var(--primary-green);
            color: #fff; border-radius: 2rem;
            padding: .25rem .75rem;
            font-size: .85rem;
            display: inline-block;
            font-weight: 500;
            margin-right: 0.5rem; /* Space between multiple badges */
            margin-bottom: 0.5rem; /* Space below badges */
        }
        /* Stars in card */
        .result-card .stars {
            color: #f5c518; /* Yellow for stars */
            margin-left: 0.1rem; /* Added space between name and stars */
            margin-right: 0.1rem;
        }
        .eco-icon {
            width: 1.2rem;
            vertical-align: middle;
            margin-left: 0.3rem;
            color: var(--primary-green); /* Ensure eco icon is green */
        }

        /* Common styles for both rating badges */
        .rating-badge-image, .rating-badge-list-view {
            display: inline-flex;
            width: 2.5rem; height: 1.8rem;
            align-items: center; justify-content: center;
            background: var(--primary-green);
            color: #fff; border-radius: 0.4rem;
            font-weight: 600;
            font-size: 0.9rem;
            z-index: 10;
            position: absolute;
        }

        /* Hide both by default */
        .rating-badge-image { display: none; }
        .rating-badge-list-view { display: none; }

        .result-info h5 {
            display: inline-block;
            margin-bottom: 0;
            /* No specific vertical-align here, handled by flexbox on parent */
        }
        .result-info .d-flex.align-items-center {
            align-items: baseline; /* Align name and stars to the top of their container */
        }

        /* Blue/Green bar inside result card */
        .result-card .highlight-bar {
            width: 100%;
            height: 4px;
            background-color: var(--primary-green); /* Changed to green */
            margin-top: 0.5rem; /* Space below the feature list */
            margin-bottom: 0.75rem; /* Space before price details */
            border-radius: 2px;
        }

        /* LIST VIEW: horizontal flex */
        .list-view .result-card {
            display: flex;
            flex-wrap: nowrap;
            align-items: stretch;
            min-height: 300px; /* Standard minimum height for list view */
        }
        .list-view .result-card > div.result-image-col {
            flex: 0 0 28%;
            position: relative; /* Make image col positioned for its children */
            overflow: hidden;
            border-top-left-radius: 1rem;
            border-bottom-left-radius: 1rem;
        }
        .list-view .result-card > div.result-image-col img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .list-view .result-card > div.result-info-col {
            flex: 1 1 50%;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .list-view .result-card > div.result-price-col {
            flex: 0 0 22%;
            padding: 1rem;
            text-align: right;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: flex-end;
        }
        .list-view .result-info-col .mb-0 { margin-bottom: 0 !important; }

        /* Positioning for LIST VIEW */
        .list-view .result-card .wishlist-btn {
            top: 0.75rem;
            right: 1rem; /* Positioned relative to .result-card */
        }
        .list-view .result-card .rating-badge-list-view {
            display: flex; /* Show this badge in list view */
            top: 0.1rem;
            margin-top: 0.4rem;
            right: 1rem; /* Positioned relative to .result-card */
        }
        .list-view .result-card > div.result-price-col > div {
            margin-top: 1.5rem; /* Push price details down to accommodate rating badge */
        }


        /* GRID VIEW: two-column */
        .grid-view {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        .grid-view .result-card {
            display: flex;
            flex-direction: column;
            margin-bottom: 0;
            min-height: 300px; /* Taller minimum height for grid view to show more of image */
        }
        .grid-view .result-card > div.result-image-col {
            width: 100%;
            height: 250px; /* More height for image in grid view */
            overflow: hidden;
            border-top-left-radius: 1rem;
            border-top-right-radius: 1rem;
            border-bottom-left-radius: 0;
            position: relative; /* Make image col positioned for its children */
        }
        .grid-view .result-card > div.result-image-col img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .grid-view .result-card > div.result-info-col,
        .grid-view .result-card > div.result-price-col {
            padding: 1rem;
        }
        .grid-view .result-card > div.result-price-col {
            text-align: left;
            flex-direction: column; /* Changed to column for vertical stacking */
            justify-content: flex-end; /* Push content to the bottom */
            align-items: center; /* Center horizontally */
            flex-grow: 1; /* Allow price column to grow and push button down */
        }
        .grid-view .result-card .price {
            margin-bottom: 0;
        }
        .grid-view .btn-see {
            margin-top: 0.5rem; /* Add some space above the button */
        }

        /* Positioning for GRID VIEW */
        .grid-view .result-card .wishlist-btn {
            top: 0.75rem;
            right: 4rem; /* Positioned relative to .result-image-col (its parent) */
        }
        .grid-view .result-card .rating-badge-image {
            display: flex; /* Show this badge in grid view */
            top: 1.1rem; /* Positioned relative to .result-image-col (its parent) */
            right: 0.75rem;
        }


        /* Offers section */
        .offers-card {
            background-color: #f0fdf4;
            border-radius: 1.5rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
            margin-bottom: 2.5rem; /* Increased margin to prevent overlap */
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--green-tint-bg);
        }
        .offers-card .title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--green-active-dark);
            margin-bottom: 0.5rem;
        }
        .offers-card .subtitle {
            font-size: 1rem;
            color: var(--green-active);
            margin-bottom: 1rem;
        }
        .offers-card .action-btn {
            background-color: var(--green-active);
            color: #fff;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: background-color 0.2s;
            border: none;
        }
        .offers-card .action-btn:hover {
            background-color: var(--green-active-dark);
        }
        .offers-card .illustration {
            width: 100px;
            height: 100px;
            object-fit: contain;
            margin-left: 1rem;
        }

        /* GIF Ad Card specific styling */
        .ad-card.result-card {
            overflow: hidden; /* Ensure content doesn't spill */
            min-height: 250px; /* Maintain consistent height */
        }

        .list-view .ad-card > div.result-image-col {
            flex: 0 0 60%; /* More room for GIF in list view */
            height: auto; /* Allow height to adjust to content */
            border-bottom-left-radius: 1rem;
            border-top-right-radius: 0; /* Remove top-right radius for smooth transition to info-col */
        }
        .list-view .ad-card > div.result-info-col {
            flex: 0 0 40%; /* Less room for text in list view */
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 0.75rem; /* Reduced padding */
            background-color: honeydew;
        }

        .grid-view .ad-card > div.result-image-col {
            height: 250px; /* Taller GIF in grid view */
        }
        .grid-view .ad-card > div.result-info-col {
            padding: 0.75rem; /* Reduced padding */
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Show on Map button style */
        .map-section {
            position: relative;
            text-align: center;
            border-radius: 1.5rem; /* Match parent container */
            overflow: hidden; /* Ensure button doesn't spill */
            padding: 0; /* Remove padding from here as content is directly inside */
        }
        .map-section img {
            display: block;
            width: 100%;
            height: auto;
            border-radius: 1.5rem; /* Apply radius to image directly */
        }
        .map-button {
            position: absolute;
            bottom: 1rem; /* Position at the bottom */
            left: 50%;
            transform: translateX(-50%); /* Only horizontal centering */
            background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end));
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
            z-index: 10; /* Ensure it's above the map image */
        }
        .map-button:hover {
            transform: translateX(-50%) translateY(-2px); /* Only vertical hover effect */
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        /* ===== Footer ===== */
        footer {
            background-color: var(--footer-bg);
            color: var(--footer-text);
            padding: 40px 0;
            margin-top: 2rem;
            margin-bottom: -40px;
        }
        .footer-logo img {
            height: 40px;
        }
        .footer-desc {
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        .footer-links a {
            display: block;
            color: var(--footer-text);
            margin-bottom: 0.5rem;
            transition: color 0.2s ease;
        }
        .footer-links a:hover {
            color: var(--hover-green);
        }
        .social-icons a {
            color: var(--footer-text);
            font-size: 1.2rem;
            margin-right: 15px;
            transition: box-shadow 0.3s ease, color 0.2s ease;
            display: inline-block;
        }
        .social-icons a:hover {
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
            color: var(--hover-green);
        }
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            font-size: 0.85rem;
            border-top: 1px solid #ddd;
            margin-top: 20px;
        }

        /* Keyframe for fadeInScale */
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Responsive adjustments */
        @media (max-width: 991.98px) {
            .header-section-content {
                padding-top: 1rem;
                padding-bottom: 1rem;
            }
            .header-section-content h1 {
                padding-left: 0; /* Remove padding on smaller screens */
                padding-right: 0; /* Remove padding on smaller screens */
                text-align: center; /* Center align on smaller screens if desired, or keep left */
            }

            .main-search-pill-container {
                flex-direction: column;
                padding: 1rem;
                border-radius: 1.5rem;
                margin-top: 1rem; /* Adjusted for no overlap */
            }
            .main-search-pill-item {
                width: 100%;
                margin-bottom: 0.75rem;
            }
            .main-search-pill-item:last-of-type {
                margin-bottom: 0;
            }
            .main-search-pill-item.guest-popover-container {
                 min-width: unset; /* Reset min-width for mobile stacking */
            }
            .btn-main-search {
                width: 100%;
                margin-top: 0.5rem;
            }

            .list-view .result-card,
            .grid-view .result-card {
                flex-direction: column;
            }
            .list-view .result-card > div.result-image-col,
            .grid-view .result-card > div.result-image-col {
                width: 100%;
                height: 200px;
                border-radius: 1rem 1rem 0 0;
            }
            .list-view .result-card > div.result-info-col,
            .grid-view .result-card > div.result-info-col {
                width: 100%;
            }
            .list-view .result-card > div.result-price-col,
            .grid-view .result-card > div.result-price-col {
                width: 100%;
                text-align: left;
                padding-top: 0.5rem;
                justify-content: flex-start;
                align-items: flex-start;
                flex-direction: column;
            }
            .list-view .result-card > div.result-price-col .btn-see,
            .grid-view .result-card > div.result-price-col .btn-see {
                margin-top: 0.5rem;
            }
            .grid-view {
                grid-template-columns: 1fr;
            }
            .offers-card {
                flex-direction: column;
                text-align: center;
                padding: 1rem;
            }
            .offers-card .illustration {
                margin-left: 0;
                margin-top: 1rem;
            }
             .entire-home-checkbox-container {
                padding: 0 1rem; /* Maintain padding on smaller screens */
            }

            /* Ad Card responsive adjustments for smaller screens */
            .list-view .ad-card > div.result-image-col {
                flex: 0 0 auto; /* Reset flex */
                width: 100%; /* Take full width */
                height: 200px; /* Maintain a good height */
            }
            .list-view .ad-card > div.result-info-col {
                flex: 0 0 auto; /* Reset flex */
                width: 100%; /* Take full width */
            }
        }
        @media (max-width: 767.98px) {
            body {
                padding-top: 56px;
            }
            .header-section-content {
                padding-top: 0.5rem;
                padding-bottom: 0.5rem;
            }
            /* .gif-ad-grid was removed */
            .main-search-pill-container {
                margin-top: 1rem; /* Adjusted for no overlap */
                padding: 0.75rem;
                border-radius: 1rem;
            }
            .main-search-pill-item {
                height: 44px;
                padding: 0.4rem 0.8rem;
            }
            h1 {
                font-size: 1.75rem;
            }
            .filter-section {
                padding: 0.8rem 1rem;
                border-radius: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- ===== Navbar ===== -->
    <nav id="mainNavbar" class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <!-- Local image path for logo -->
                <img src="img/logo.png" alt="ETCP Logo" />
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                    <li class="nav-item">
                        <a class="nav-link" href="register.html">Register your property</a>
                    </li>
                    <li class="nav-item"><a class="nav-link active" href="plan.html">Plan your trip</a></li>
                    <li class="nav-item"><a class="nav-link" href="about.html">About us</a></li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <!-- Local image path for flag -->
                            <img src="img/flag.png" alt="Language" style="height:24px; border-radius:50%;" />
                        </a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="signin.html">Sign in</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="header-section-content">
        <div class="container">
            <h1 class="h3 font-weight-bold mb-4 text-dark">Explore Destinations</h1>

            <!-- Main Search Pill -->
            <div class="main-search-pill-container">
                <div class="main-search-pill-item">
                    <i class="fas fa-location-dot"></i> <!-- Changed to location icon -->
                    <input type="text" id="locationInput" placeholder="Search location" value="">
                </div>
                <div class="main-search-pill-item">
                    <i class="fas fa-calendar-alt"></i>
                    <input type="date" id="fromDate">
                </div>
                <div class="main-search-pill-item">
                    <i class="fas fa-calendar-alt"></i>
                    <input type="date" id="toDate">
                </div>
                <div class="main-search-pill-item guest-popover-container" id="guestsPill">
                    <i class="fas fa-user"></i>
                    <span id="adultsChildrenDisplay">2 adults - 0 children</span>
                    <i class="fas fa-chevron-down ms-auto text-xs"></i>
                    <!-- Dropdown for quantity selection -->
                    <div class="guest-popover shadow-lg" id="guestsPopover">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <span>Adults:</span>
                            <div class="quantity-selector">
                                <button class="minus-btn" data-target="adults">-</button>
                                <span class="quantity-display" id="adultsQuantity">2</span>
                                <button class="plus-btn" data-target="adults">+</button>
                            </div>
                        </div>
                        <div class="d-flex align-items-center justify-content-between">
                            <span>Children:</span>
                            <div class="quantity-selector">
                                <button class="minus-btn" data-target="children">-</button>
                                <span class="quantity-display" id="childrenQuantity">0</span>
                                <button class="plus-btn" data-target="children">+</button>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="btn-main-search" id="searchHeaderButton"> 
                    <i class="fas fa-search"></i> Search
                </button>
            </div>
            <!-- Entire Home Checkbox moved for alignment -->
            <div class="entire-home-checkbox-container">
                <input type="checkbox" id="entireHomeCheckbox" class="me-2">
                <label for="entireHomeCheckbox">I'm looking for an entire home or apartment</label>
            </div>
        </div>
    </section>

    <div class="container mx-auto px-4 py-8">
        <div class="row g-4 mt-1">
            <!-- Left Sidebar (Filters) -->
            <aside class="col-12 col-lg-3">
                <!-- Show on Map section -->
                <div class="filter-section p-0 overflow-hidden map-section">
                    <!-- Local image path for map -->
                    <img src="img/map.png" alt="Map View">
                    <button class="map-button">
                        <i class="fas fa-location-dot"></i> Show on map
                    </button>
                </div>

                <div class="filter-section mt-4">
                    <div class="filter-section-header" data-bs-toggle="collapse" data-bs-target="#filterContentBudget" aria-expanded="true" aria-controls="filterContentBudget">
                        <h3>Budget (per night)</h3>
                        <i class="fas fa-chevron-up"></i>
                    </div>
                    <div class="filter-content collapse show" id="filterContentBudget">
                        <div id="budgetSliderContainer">
                            <div class="budget-slider-track"></div>
                            <div class="budget-slider-track-filled" id="budgetRangeFilled"></div>
                            <input type="range" min="2000" max="50000" value="2000" class="form-range" id="budgetSliderMin">
                            <input type="range" min="2000" max="50000" value="50000" class="form-range" id="budgetSliderMax">
                        </div>
                        <div class="d-flex justify-content-between small text-muted mt-1">
                            <span id="minBudgetDisplay">LKR 2,000</span>
                            <span id="maxBudgetDisplay">LKR 50,000+</span>
                        </div>
                    </div>
                </div>

                <div class="filter-section">
                    <div class="filter-section-header" data-bs-toggle="collapse" data-bs-target="#filterContentDeals" aria-expanded="true" aria-controls="filterContentDeals">
                        <h3>Deals</h3>
                        <i class="fas fa-chevron-up"></i>
                    </div>
                    <div class="filter-content collapse show" id="filterContentDeals">
                        <div class="custom-checkbox">
                            <input type="checkbox" id="filterEcoRewards" value="Eco rewards">
                            <label for="filterEcoRewards">Eco rewards <i class="fas fa-trophy text-primary-green"></i></label>
                        </div>
                        <div class="custom-checkbox">
                            <input type="checkbox" id="filterGetawayDeal" value="Getaway deal">
                            <label for="filterGetawayDeal">Getaway Deal</label>
                        </div>
                        <div class="custom-checkbox">
                            <input type="checkbox" id="filterLastMinuteDeal" value="Last Minute Deal">
                            <label for="filterLastMinuteDeal">Last Minute Deal</label>
                        </div>
                    </div>
                </div>

                <div class="filter-section">
                    <div class="filter-section-header" data-bs-toggle="collapse" data-bs-target="#filterContentMeals" aria-expanded="true" aria-controls="filterContentMeals">
                        <h3>Meals</h3>
                        <i class="fas fa-chevron-up"></i>
                    </div>
                    <div class="filter-content collapse show" id="filterContentMeals">
                        <div class="custom-checkbox"><input type="checkbox" id="mealBreakfast" value="Breakfast included"><label for="mealBreakfast">Breakfast included</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="mealHalfBoard" value="Half board"><label for="mealHalfBoard">Half board</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="mealFullBoard" value="Full board"><label for="mealFullBoard">Full board</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="mealAllInclusive" value="All-inclusive"><label for="mealAllInclusive">All-inclusive</label></div>
                    </div>
                </div>

                <div class="filter-section">
                    <div class="filter-section-header" data-bs-toggle="collapse" data-bs-target="#filterContentType" aria-expanded="true" aria-controls="filterContentType">
                        <h3>Property type</h3>
                        <i class="fas fa-chevron-up"></i>
                    </div>
                    <div class="filter-content collapse show" id="filterContentType">
                        <div class="custom-checkbox"><input type="checkbox" id="typeHotels" value="Hotel"><label for="typeHotels">Hotels</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="typeApartments" value="Apartment"><label for="typeApartments">Apartments</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="typeVillas" value="Villa"><label for="typeVillas">Villas</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="typeGuesthouses" value="Guesthouse"><label for="typeGuesthouses">Guesthouses</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="typeHostels" value="Hostel"><label for="typeHostels">Hostels</label></div>
                    </div>
                </div>

                <div class="filter-section">
                    <div class="filter-section-header" data-bs-toggle="collapse" data-bs-target="#filterContentRooms" aria-expanded="true" aria-controls="filterContentRooms">
                        <h3>Bedrooms & bathrooms</h3>
                        <i class="fas fa-chevron-up"></i>
                    </div>
                    <div class="filter-content collapse show" id="filterContentRooms">
                        <div class="mb-2">
                            <label for="bedroomsQuantity" class="small text-muted d-block mb-1">Bedrooms:</label>
                            <div class="quantity-selector">
                                <button class="minus-btn" data-target="bedrooms">-</button>
                                <span class="quantity-display" id="bedroomsQuantity">1</span>
                                <button class="plus-btn" data-target="bedrooms">+</button>
                            </div>
                        </div>
                        <div>
                            <label for="bathroomsQuantity" class="small text-muted d-block mb-1">Bathrooms:</label>
                            <div class="quantity-selector">
                                <button class="minus-btn" data-target="bathrooms">-</button>
                                <span class="quantity-display" id="bathroomsQuantity">1</span>
                                <button class="plus-btn" data-target="bathrooms">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="filter-section">
                    <div class="filter-section-header" data-bs-toggle="collapse" data-bs-target="#filterContentActivity" aria-expanded="true" aria-controls="filterContentActivity">
                        <h3>Type of activity</h3>
                        <i class="fas fa-chevron-up"></i>
                    </div>
                    <div class="filter-content collapse show" id="filterContentActivity">
                        <div class="custom-checkbox"><input type="checkbox" id="activityVolunteering" value="Volunteering"><label for="activityVolunteering">Volunteering</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="activityHiking" value="Hiking"><label for="activityHiking">Hiking</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="activityDiving" value="Diving"><label for="activityDiving">Diving</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="activityCycling" value="Cycling"><label for="activityCycling">Cycling</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="activitySafari" value="Safari"><label for="activitySafari">Safari</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="activityCultural" value="Cultural"><label for="activityCultural">Cultural</label></div>
                    </div>
                </div>

                <div class="filter-section">
                    <div class="filter-section-header" data-bs-toggle="collapse" data-bs-target="#filterContentRating" aria-expanded="true" aria-controls="filterContentRating">
                        <h3>Property rating</h3>
                        <i class="fas fa-chevron-up"></i>
                    </div>
                    <div class="filter-content collapse show" id="filterContentRating">
                        <div class="custom-radio">
                            <input type="radio" id="ratingAny" name="propertyRating" value="0" checked>
                            <label for="ratingAny">Any</label>
                        </div>
                        <div class="custom-radio">
                            <input type="radio" id="rating9Plus" name="propertyRating" value="9">
                            <label for="rating9Plus"><span class="rating-stars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i></span> 9+ Superb</label>
                        </div>
                        <div class="custom-radio">
                            <input type="radio" id="rating8Plus" name="propertyRating" value="8">
                            <label for="rating8Plus"><span class="rating-stars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></span> 8+ Very Good</label>
                        </div>
                        <div class="custom-radio">
                            <input type="radio" id="rating7Plus" name="propertyRating" value="7">
                            <label for="rating7Plus"><span class="rating-stars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></span> 7+ Good</label>
                        </div>
                    </div>
                </div>

                <div class="filter-section">
                    <div class="filter-section-header" data-bs-toggle="collapse" data-bs-target="#filterContentFacilities" aria-expanded="true" aria-controls="filterContentFacilities">
                        <h3>Facilities</h3>
                        <i class="fas fa-chevron-up"></i>
                    </div>
                    <div class="filter-content collapse show" id="filterContentFacilities">
                        <div class="custom-checkbox"><input type="checkbox" id="facPool" value="Swimming pool"><label for="facPool">Swimming pool</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="facWifi" value="Free Wi-Fi"><label for="facWifi">Free Wi-Fi</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="facParking" value="Free Parking"><label for="facParking">Free Parking</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="facPets" value="Pets Allowed"><label for="facPets">Pets Allowed</label></div>
                    </div>
                </div>

                <div class="filter-section">
                    <div class="filter-section-header" data-bs-toggle="collapse" data-bs-target="#filterContentPolicy" aria-expanded="true" aria-controls="filterContentPolicy">
                        <h3>Reservation policy</h3>
                        <i class="fas fa-chevron-up"></i>
                    </div>
                    <div class="filter-content collapse show" id="filterContentPolicy">
                        <div class="custom-checkbox"><input type="checkbox" id="polFreeCancellation" value="Free cancellation"><label for="polFreeCancellation">Free cancellation</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="polPayLater" value="Pay later"><label for="polPayLater">Pay later</label></div>
                    </div>
                </div>

                <div class="filter-section">
                    <div class="filter-section-header" data-bs-toggle="collapse" data-bs-target="#filterContentGroup" aria-expanded="true" aria-controls="filterContentGroup">
                        <h3>Travel group</h3>
                        <i class="fas fa-chevron-up"></i>
                    </div>
                    <div class="filter-content collapse show" id="filterContentGroup">
                        <div class="custom-checkbox"><input type="checkbox" id="grpSolo" value="Solo travel"><label for="grpSolo">Solo travel</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="grpFamily" value="Family"><label for="grpFamily">Family</label></div>
                        <div class="custom-checkbox"><input type="checkbox" id="grpBusiness" value="Business"><label for="grpBusiness">Business</label></div>
                    </div>
                </div>
            </aside>

            <!-- Main Content Area (Results) -->
            <section class="col-12 col-lg-9">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div id="viewToggle" class="toggle-pill">
                        <button data-view="list" class="active">List</button>
                        <button data-view="grid">Grid</button>
                        <div class="slider"></div>
                    </div>
                    <div class="sort-dropdown dropdown">
                        <button id="sortBtn" class="btn btn-light dropdown-toggle" type="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-sort me-2"></i>
                            Sort by: <strong id="sortLabel">Price (lowest first)</strong>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" data-value="Price (lowest first)" href="#">Price (lowest first)</a></li>
                            <li><a class="dropdown-item" data-value="Price (highest first)" href="#">Price (highest first)</a></li>
                            <li><a class="dropdown-item" data-value="Property rating (high to low)" href="#">Property rating (high to low)</a></li>
                            <li><a class="dropdown-item" data-value="Property rating (low to high)" href="#">Property rating (low to high)</a></li>
                            <li><a class="dropdown-item" data-value="Top picks for solo travellers" href="#">Top picks for solo travellers</a></li>
                            <li><a class="dropdown-item" data-value="Homes &amp; apartments first" href="#">Homes &amp; apartments first</a></li>
                            <li><a class="dropdown-item" data-value="Distance from city centre" href="#">Distance from city centre</a></li>
                            <li><a class="dropdown-item" data-value="Top reviewed" href="#">Top reviewed</a></li>
                            <li><a class="dropdown-item" data-value="Distance from closest beach" href="#">Distance from closest beach</a></li>
                        </ul>
                    </div>
                </div>

                <div id="resultsContainer" class="list-view">
                    <!-- Results will be dynamically inserted here -->
                </div>
            </section>
        </div>
    </div>


    <!-- ===== Footer ===== -->
    <footer>
        <div class="container">
            <div class="row gy-4">
                <div class="col-md-4 footer-logo">
                    <!-- Local image path for footer logo -->
                    <img src="img/logo.png" alt="ETCP logo" style="width: 120px; height: 75px;">
                    <p class="footer-desc">
                        The ETCP is an innovative cloud-based platform designed to revolutionize the way eco-conscious travellers discover, plan, and engage with eco-tourism experiences worldwide.
                    </p>
                </div>
                <div class="col-md-2 footer-links">
                    <h6>Discover</h6>
                    <a href="#">Home</a>
                    <a href="#">Features</a>
                    <a href="#">Destinations</a>
                </div>
                <div class="col-md-2 footer-links">
                    <h6>Support</h6>
                    <a href="#">Help Center</a>
                    <a href="#">FAQs</a>
                    <a href="#">Contact Support</a>
                </div>
                <div class="col-md-2 footer-links">
                    <h6>Partners</h6>
                    <a href="#">Become a Provider</a>
                    <a href="#">Affiliates</a>
                </div>
                <div class="col-md-2 footer-links">
                    <h6>Legal</h6>
                    <a href="#">Terms & Settings</a>
                    <a href="#">Privacy Policy</a>
                    <a href="#">Contact Us</a>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col text-center social-icons">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Copyright  2025 ETCP.com. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS bundle (with Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        // wishlistItems will now only manage state for the current session, no persistence.
        let wishlistItems = []; // Array to store favorited property IDs for the current session

        // Variables for quantities in the search bar
        let adultsCount = 2; // Default adults
        let childrenCount = 0; // Default children

        // ===== Data for Properties (Moved to global scope) =====
        const allProperties = [
            {
                id: 1,
                name: "Anderson Tropicz",
                location: "Kandy",
                distance: "1.8 Km from centre",
                nearby: "Beach nearby",
                price: 10800,
                rating: 8.9,
                reviews: 108,
                image: "img/Anderson tropics.jpg",
                deal: ["Getaway deal", "Eco rewards"],
                type: "Hotel",
                activity: ["Cultural", "Safari"],
                features: ["Deluxe Double Room", "1 King size bed", "Free Wi-Fi", "Free cancellation", "No prepayment needed - pay at the property"],
                meals: [],
                bedrooms: 1,
                bathrooms: 1,
                facilities: ["Free Wi-Fi", "Swimming pool"],
                policy: ["Free cancellation", "Pay later"],
                group: ["Family"],
            },
            {
                id: 2,
                name: "Udarata Bungalow",
                location: "Nuwara Eliya",
                distance: "2.5 Km from city",
                nearby: "Tea plantations nearby",
                price: 18980,
                rating: 9.1,
                reviews: 57,
                image: "img/Udarata Bungalow.jpg",
                deal: ["Getaway deal"],
                type: "Villa",
                activity: ["Hiking"],
                features: ["Single Room", "2 double beds", "Breakfast included", "Mountain view", "Garden access"],
                meals: ["Breakfast included"],
                bedrooms: 2,
                bathrooms: 1,
                facilities: ["Free Parking", "Garden"],
                policy: ["Pay later"],
                group: ["Family"],
            },
            {
                id: 3,
                name: "Coastal Retreat",
                location: "Galle",
                distance: "0.5 Km from fort",
                nearby: "Beach nearby",
                price: 7500,
                rating: 8.5,
                reviews: 120,
                image: "img/Coastal Retreat.jpg",
                deal: [],
                type: "Apartment",
                activity: ["Cultural", "Diving"],
                features: ["Standard Apartment", "1 Queen bed", "Free Wi-Fi", "Kitchenette", "Ocean view"],
                meals: [],
                bedrooms: 1,
                bathrooms: 1,
                facilities: ["Free Wi-Fi", "Kitchen"],
                policy: [],
                group: ["Solo travel", "Couples"],
            },
            {
                id: 4,
                name: "Lion Rock Eco Stay",
                location: "Sigiriya",
                distance: "500m from Lion Rock",
                nearby: "Historical sites",
                price: 12500,
                rating: 9.0,
                reviews: 88,
                image: "img/Lion Rock Eco Stay.jpg",
                deal: ["Last Minute Deal"],
                type: "Guesthouse",
                activity: ["Hiking", "Cycling"],
                features: ["Family Bungalow", "2 Queen beds", "Breakfast included", "Eco-friendly practices", "Bicycle rental"],
                meals: ["Breakfast included"],
                bedrooms: 2,
                bathrooms: 2,
                facilities: ["Free Parking", "Bicycle rental"],
                policy: [],
                group: ["Family"],
            },
            {
                id: 5,
                name: "Ella Hidden Trails",
                location: "Ella",
                distance: "1 Km from Nine Arch Bridge",
                nearby: "Waterfalls and trails",
                price: 9000,
                rating: 8.7,
                reviews: 95,
                image: "img/Ella Hidden Trails.jpg",
                deal: [],
                type: "Hotel",
                activity: ["Hiking", "Volunteering"],
                features: ["Standard Room", "1 Double bed", "Free cancellation", "Balcony with view", "Tour desk"],
                meals: [],
                bedrooms: 1,
                bathrooms: 1,
                facilities: ["Tour desk"],
                policy: ["Free cancellation"],
                group: ["Solo travel"],
            },
             {
                id: 6,
                name: "Jaffna Cultural Haven",
                location: "Jaffna",
                distance: "1.2 Km from Nallur Kovil",
                nearby: "City center",
                price: 11500,
                rating: 8.8,
                reviews: 72,
                image: "img/Jaffna Cultural Haven.jpg",
                deal: ["Eco rewards"],
                type: "Guesthouse",
                activity: ["Cultural"],
                features: ["Comfort Room", "1 Queen bed", "Free Wi-Fi", "Air conditioning", "Private bathroom"],
                meals: ["Breakfast included"],
                bedrooms: 1,
                bathrooms: 1,
                facilities: ["Free Wi-Fi", "Air conditioning"],
                policy: ["Free cancellation"],
                group: ["Solo travel"],
            },
             {
                id: 7,
                name: "Colombo City Eco Lodge",
                location: "Colombo",
                distance: "18 Km from Galle Face Green",
                nearby: "Shopping and dining",
                price: 22000,
                rating: 9.3,
                reviews: 210,
                image: "img/Colombo City Eco Lodge.webp",
                deal: ["Getaway deal"],
                type: "Hotel",
                activity: ["Cultural", "Business"],
                features: ["Executive Suite", "King size bed", "City view", "Gym Access", "24-hour front desk"],
                meals: ["Breakfast included", "Full board"],
                bedrooms: 1,
                bathrooms: 1,
                facilities: ["Swimming pool", "Free Wi-Fi", "Free Parking", "Gym"],
                policy: ["Pay later"],
                group: ["Business"],
            },
            {
                id: 8,
                name: "Arugam Bay Surf Camp",
                location: "Arugam Bay",
                distance: "0.1 Km from beach",
                nearby: "Surfing spots",
                price: 6500,
                rating: 8.2,
                reviews: 45,
                image: "img/Arugam Bay Surf Camp.jpg",
                deal: [],
                type: "Hostel",
                activity: ["Diving", "Safari"],
                features: ["Dorm Bed", "Shared bathroom", "Surfboard rental", "Beach access", "Locker service"],
                meals: ["Breakfast included"],
                bedrooms: 1, // Representing a dorm bed as 1 bedroom for simplicity in filtering
                bathrooms: 1, // Shared bathroom
                facilities: ["Free Wi-Fi", "Surfboard rental"],
                policy: [],
                group: ["Solo travel"],
            },
            {
                id: 9,
                name: "Sigiriya Green View",
                location: "Sigiriya",
                distance: "2.0 Km from Lion Rock",
                nearby: "Jungle views",
                price: 9800,
                rating: 8.6,
                reviews: 60,
                image: "img/Sigiriya Green View.jpg",
                deal: ["Eco rewards"],
                type: "Guesthouse",
                activity: ["Hiking", "Cultural"],
                features: ["Standard Double Room", "1 Double Bed", "Private Balcony", "Breakfast included", "Nature trails"],
                meals: ["Breakfast included"],
                bedrooms: 1,
                bathrooms: 1,
                facilities: ["Garden", "Free Parking"],
                policy: ["Free cancellation"],
                group: ["Couples"],
            },
            {
                id: 10,
                name: "Kandy Riverside Inn",
                location: "Kandy",
                distance: "0.8 Km from Temple of Tooth",
                price: 13500,
                rating: 9.2,
                reviews: 150,
                image: "img/Kandy Riverside Inn.jpg",
                deal: ["Getaway deal"],
                type: "Hotel",
                activity: ["Cultural", "Business"],
                features: ["Executive Room", "King size bed", "River view", "Restaurant", "Spa services"],
                meals: ["Half board"],
                bedrooms: 1,
                bathrooms: 1,
                facilities: ["Restaurant", "Free Wi-Fi", "Spa"],
                policy: ["Pay later"],
                group: ["Family", "Business"],
            },
            {
                id: 11,
                name: "Mirissa Beach House",
                location: "Mirissa",
                distance: "0.2 Km from beach",
                nearby: "Whale watching tours",
                price: 15000,
                rating: 9.5,
                reviews: 200,
                image: "img/Mirissa Beach House.jpg",
                deal: ["Getaway deal"],
                type: "Villa",
                activity: ["Diving", "Cultural"],
                features: ["Ocean View Villa", "2 King beds", "Private pool", "Free breakfast", "Direct beach access"],
                meals: ["Breakfast included"],
                bedrooms: 2,
                bathrooms: 2,
                facilities: ["Swimming pool", "Free Wi-Fi", "Free Parking"],
                policy: ["Free cancellation"],
                group: ["Family", "Couples"],
            },
            {
                id: 12,
                name: "Unawatuna Coral Retreat",
                location: "Unawatuna",
                distance: "0.5 Km from Japanese Peace Pagoda",
                nearby: "Coral reefs",
                price: 8500,
                rating: 8.8,
                reviews: 110,
                image: "img/Unawatuna Coral Retreat.jpeg",
                deal: ["Eco rewards"],
                type: "Guesthouse",
                activity: ["Diving"],
                features: ["Standard Room", "1 Queen bed", "Snorkelling gear rental", "Garden view", "Restaurant on-site"],
                meals: ["Half board"],
                bedrooms: 1,
                bathrooms: 1,
                facilities: ["Restaurant", "Free Wi-Fi"],
                policy: ["Pay later"],
                group: ["Solo travel", "Couples"],
            },
            {
                id: 13,
                name: "Galle Fort Heritage Stay",
                location: "Galle",
                distance: "0.1 Km from Galle Fort Lighthouse",
                nearby: "Historic Fort",
                price: 17000,
                rating: 9.0,
                reviews: 180,
                image: "img/Galle Fort Heritage Stay.jpg",
                deal: ["Last Minute Deal"],
                type: "Hotel",
                activity: ["Cultural"],
                features: ["Deluxe Heritage Room", "1 King bed", "Fort view", "Free Wi-Fi", "Historical building"],
                meals: [],
                bedrooms: 1,
                bathrooms: 1,
                facilities: ["Free Wi-Fi"],
                policy: ["Free cancellation"],
                group: ["Couples", "Business"],
            },
            {
                id: 14,
                name: "Yala Wild Safari Lodge",
                location: "Yala",
                distance: "5.0 Km from Yala National Park",
                nearby: "Wildlife",
                price: 25000,
                rating: 9.4,
                reviews: 90,
                image: "img/Yala Wild Safari Lodge.webp",
                deal: ["Getaway deal"],
                type: "Hotel",
                activity: ["Safari"],
                features: ["Luxury Tent", "2 Single beds", "Safari tour included", "Private deck", "Wildlife viewing"],
                meals: ["Full board"],
                bedrooms: 1,
                bathrooms: 1,
                facilities: ["Restaurant", "Free Parking"],
                policy: ["Pay later"],
                group: ["Family", "Solo travel"],
            },
            {
                id: 15,
                name: "Trincomalee Dive Resort",
                location: "Trincomalee",
                distance: "0.3 Km from Nilaveli Beach",
                nearby: "Pigeon Island",
                price: 11000,
                rating: 8.7,
                reviews: 75,
                image: "img/Trincomalee Dive Resort.webp",
                deal: [],
                type: "Hotel",
                activity: ["Diving"],
                features: ["Beachfront Bungalow", "1 Double bed", "Dive center on-site", "Ocean view", "Free Wi-Fi"],
                meals: [],
                bedrooms: 1,
                bathrooms: 1,
                facilities: ["Free Wi-Fi", "Beach Access"],
                policy: ["Free cancellation"],
                group: ["Solo travel", "Couples"],
            }
        ];

        const adImages = [
            "img/explore-green.gif",
            "img/new-adventures.gif",
            "img/book-now.gif"
        ];

        document.addEventListener('DOMContentLoaded', async function() {
            // Get references to main search pill elements
            const locationInput = document.getElementById('locationInput');
            const fromDateInput = document.getElementById('fromDate');
            const toDateInput = document.getElementById('toDate');
            const adultsChildrenDisplay = document.getElementById('adultsChildrenDisplay');
            const guestsPill = document.getElementById('guestsPill');
            const guestsPopover = document.getElementById('guestsPopover');
            const adultsQuantitySpan = document.getElementById('adultsQuantity');
            const childrenQuantitySpan = document.getElementById('childrenQuantity');
            const entireHomeCheckbox = document.getElementById('entireHomeCheckbox');
            const searchHeaderButton = document.getElementById('searchHeaderButton');

            // Get references to filter quantity selectors
            const bedroomsQuantitySpan = document.getElementById('bedroomsQuantity');
            const bathroomsQuantitySpan = document.getElementById('bathroomsQuantity');

            // Get references to budget slider
            const budgetSliderMin = document.getElementById('budgetSliderMin');
            const budgetSliderMax = document.getElementById('budgetSliderMax');
            const minBudgetDisplay = document.getElementById('minBudgetDisplay');
            const maxBudgetDisplay = document.getElementById('maxBudgetDisplay');
            const budgetRangeFilled = document.getElementById('budgetRangeFilled');

            // Get references to view toggle and sort dropdown
            const viewToggle = document.getElementById('viewToggle');
            const resultsContainer = document.getElementById('resultsContainer');
            const listButton = viewToggle.querySelector('[data-view="list"]');
            const gridButton = viewToggle.querySelector('[data-view="grid"]');
            const sortLabel = document.getElementById('sortLabel');
            const sortDropdownItems = document.querySelectorAll('.sort-dropdown .dropdown-item');

            // Function to update budget range fill
            function updateBudgetRangeFill() {
                const min = parseInt(budgetSliderMin.min);
                const max = parseInt(budgetSliderMin.max);
                const currentMin = parseInt(budgetSliderMin.value);
                const currentMax = parseInt(budgetSliderMax.value);

                const left = ((currentMin - min) / (max - min)) * 100;
                const width = ((currentMax - currentMin) / (max - min)) * 100;

                budgetRangeFilled.style.left = `${left}%`;
                budgetRangeFilled.style.width = `${width}%`;

                minBudgetDisplay.textContent = `LKR ${currentMin.toLocaleString('en-US')}`;
                maxBudgetDisplay.textContent = `LKR ${currentMax.toLocaleString('en-US')}+`;
            }

            // Event listeners for budget sliders
            budgetSliderMin.addEventListener('input', function() {
                if (parseInt(budgetSliderMin.value) > parseInt(budgetSliderMax.value)) {
                    budgetSliderMin.value = budgetSliderMax.value;
                }
                updateBudgetRangeFill();
                applyFilters();
            });

            budgetSliderMax.addEventListener('input', function() {
                if (parseInt(budgetSliderMax.value) < parseInt(budgetSliderMin.value)) {
                    budgetSliderMax.value = budgetSliderMin.value;
                }
                updateBudgetRangeFill();
                applyFilters();
            });

            // Initial update for budget slider
            updateBudgetRangeFill();


            // Immediately apply filters on load, as there's no external data dependency
            applyFilters();

            // ===== Navbar shrink on scroll =====
            const navbar = document.getElementById('mainNavbar');
            function checkNavbarScroll() {
                if (window.scrollY > 50) {
                    navbar.classList.add('navbar-shrink');
                } else {
                    navbar.classList.remove('navbar-shrink');
                }
            }
            document.addEventListener('scroll', checkNavbarScroll);
            checkNavbarScroll(); // Initial check on load

            // Set default 'From' date to today
            const today = new Date();
            fromDateInput.value = today.toISOString().split('T')[0];

            // Update initial guest counts based on HTML
            adultsCount = parseInt(adultsQuantitySpan.textContent);
            childrenCount = parseInt(childrenQuantitySpan.textContent);

            function updateGuestsDisplay() {
                adultsChildrenDisplay.textContent = `${adultsCount} adult${adultsCount !== 1 ? 's' : ''}${childrenCount > 0 ? ` - ${childrenCount} child${childrenCount !== 1 ? 'ren' : ''}` : ''}`;
            }

            // Guests Popover Toggle
            guestsPill.addEventListener('click', function(event) {
                event.stopPropagation();
                guestsPopover.classList.toggle('show');
            });
            document.addEventListener('click', function(event) {
                if (!guestsPopover.contains(event.target) && !guestsPill.contains(event.target)) {
                    guestsPopover.classList.remove('show');
                }
            });

            // Quantity Selectors in Guest Popover
            document.querySelectorAll('.quantity-selector button').forEach(button => {
                button.addEventListener('click', function(event) {
                    event.stopPropagation(); // Prevent pill click from closing popover
                    const target = this.dataset.target;
                    const type = this.classList.contains('plus-btn') ? 'plus' : 'minus';

                    if (target === 'adults') {
                        if (type === 'plus') adultsCount++;
                        else if (adultsCount > 1) adultsCount--;
                        adultsQuantitySpan.textContent = adultsCount;
                    } else if (target === 'children') {
                        if (type === 'plus') childrenCount++;
                        else if (childrenCount > 0) childrenCount--;
                        childrenQuantitySpan.textContent = childrenCount;
                    }
                    updateGuestsDisplay();
                    applyFilters();
                });
            });
            updateGuestsDisplay(); // Initial display of guest count

            // Event listeners for main search bar inputs
            locationInput.addEventListener('input', applyFilters);
            fromDateInput.addEventListener('change', applyFilters);
            toDateInput.addEventListener('change', applyFilters);
            entireHomeCheckbox.addEventListener('change', applyFilters);
            searchHeaderButton.addEventListener('click', applyFilters);

            // ===== Filter Section Collapsible Logic =====
            document.querySelectorAll('.filter-section-header').forEach(header => {
                const targetId = header.dataset.bsTarget;
                const collapseElement = document.querySelector(targetId);

                // Set initial icon state based on Bootstrap's collapse 'show' class
                if (collapseElement.classList.contains('show')) {
                     header.querySelector('i').classList.remove('fa-chevron-up');
                     header.querySelector('i').classList.add('fa-chevron-down');
                } else {
                     header.querySelector('i').classList.remove('fa-chevron-down');
                     header.querySelector('i').classList.add('fa-chevron-up');
                }

                collapseElement.addEventListener('show.bs.collapse', () => {
                    header.querySelector('i').classList.remove('fa-chevron-up');
                    header.querySelector('i').classList.add('fa-chevron-down');
                });
                collapseElement.addEventListener('hide.bs.collapse', () => {
                    header.querySelector('i').classList.remove('fa-chevron-down');
                    header.querySelector('i').classList.add('fa-chevron-up');
                });
            });


            // Quantity selectors for Bedrooms & Bathrooms
            document.querySelectorAll('.filter-section .quantity-selector button').forEach(button => {
                button.addEventListener('click', function() {
                    const target = this.dataset.target;
                    const displaySpan = document.getElementById(target + 'Quantity');
                    let currentValue = parseInt(displaySpan.textContent);

                    if (this.classList.contains('plus-btn')) {
                        currentValue++;
                    } else if (currentValue > 0) {
                        currentValue--;
                    }
                    displaySpan.textContent = currentValue;
                    applyFilters();
                });
            });

            // ===== List/Grid View Toggle Logic =====
            listButton.addEventListener('click', function() {
                listButton.classList.add('active');
                gridButton.classList.remove('active');
                viewToggle.classList.remove('grid-active');
                resultsContainer.classList.remove('grid-view');
                resultsContainer.classList.add('list-view');
            });

            gridButton.addEventListener('click', function() {
                gridButton.classList.add('active');
                listButton.classList.remove('active');
                viewToggle.classList.add('grid-active');
                resultsContainer.classList.add('grid-view');
                resultsContainer.classList.remove('list-view');
            });

            listButton.click(); // Set initial view to list

            // ===== Sort By Dropdown Logic =====
            sortDropdownItems.forEach(item => {
                item.addEventListener('click', function(event) {
                    event.preventDefault();
                    sortLabel.textContent = this.dataset.value;
                    applyFilters();
                });
            });

            // Function to generate star icons HTML based on rating
            function getStarRatingHtml(rating) {
                let starsHtml = '';
                const fullStars = Math.floor(rating / 2); // Assuming 1-10 rating, 2 points per star
                const hasHalfStar = (rating % 2) >= 1; // Check if remainder is 1 or more for half star (e.g., 8.9 -> 4.5 stars)

                for (let i = 0; i < fullStars; i++) {
                    starsHtml += '<i class="fas fa-star"></i>';
                }
                if (hasHalfStar) {
                    starsHtml += '<i class="fas fa-star-half-alt"></i>';
                }
                const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
                for (let i = 0; i < emptyStars; i++) {
                    starsHtml += '<i class="far fa-star"></i>'; // Use empty star for remaining
                }
                return `<span class="stars">${starsHtml}</span>`;
            }


            // Function to render property cards
            function renderProperties(properties) {
                resultsContainer.innerHTML = ''; // Clear current results

                // Sort properties before rendering
                const sortBy = sortLabel.textContent;
                properties.sort((a, b) => {
                    if (sortBy === "Price (lowest first)") {
                        return a.price - b.price;
                    } else if (sortBy === "Price (highest first)") {
                        return b.price - a.price;
                    } else if (sortBy === "Property rating (high to low)") {
                        return b.rating - a.rating;
                    } else if (sortBy === "Property rating (low to high)") {
                        return a.rating - b.rating;
                    }
                    return 0; // Default: no change
                });

                // Offer card HTML
                const offerCardHTML = `
                    <div class="offers-card">
                        <div>
                            <div class="title">Quick escape, quality time</div>
                            <div class="subtitle">Save up to 20% with a Getaway Deal</div>
                            <button class="action-btn">Save on stays</button>
                        </div>
                        <img src="img/offer.jpg" alt="Special Offer" class="illustration">
                    </div>
                `;

                let adCounter = 0; // To cycle through ad images
                let adIndex = 0; // To keep track of which ad to insert

                properties.forEach((property, index) => {
                    const card = document.createElement('div');
                    card.classList.add('result-card');

                    // Check if property is favorited in the current session's wishlistItems
                    const isFavorited = wishlistItems.includes(property.id);
                    // Changed icon to fa-bookmark to represent wishlist
                    const favIconClass = isFavorited ? 'fas fa-bookmark' : 'far fa-bookmark';
                    const favoritedClass = isFavorited ? 'added-to-wishlist' : '';

                    const reviewText = property.rating >= 9 ? 'Superb' : (property.rating >= 8 ? 'Very Good' : 'Good');

                    const dealBadges = property.deal.filter(dealType => dealType !== "Eco rewards").map(dealType => {
                        return `<span class="badge-deal">${dealType}</span>`;
                    }).join('');

                    card.innerHTML = `
                        <div class="result-image-col">
                            <img src="${property.image}" alt="${property.name}">
                            <button class="wishlist-btn ${favoritedClass}" data-id="${property.id}"><i class="${favIconClass}"></i></button>
                            <span class="rating-badge-image">${property.rating}</span> <!-- Badge for image in grid view -->
                        </div>
                        <div class="result-info-col">
                            <div class="d-flex align-items-baseline mb-1"> <!-- align-items-baseline for better name/star alignment -->
                                <h3 class="me-2">${property.name}</h3> <!-- Added me-2 for margin-right -->
                                ${getStarRatingHtml(property.rating)}
                                ${property.deal.includes("Eco rewards") ? '<i class="fas fa-trophy eco-icon"></i>' : ''}
                            </div>
                            <p class="mb-0 small text-muted"><b>${property.location}, Sri Lanka </b> <a href="#" class="text-success"><u>Show on Map</u></a>  ${property.distance}</p>
                            <p class="mb-2 small text-muted">${property.nearby}</p>
                            ${dealBadges}
                            <h6 class="mt-2 mb-1 text-dark">${property.features[0] || 'Room Type'}</h6>
                            <p class="mb-2 small text-muted">${property.features[1] || 'No specific bed type'}</p>
                            <div class="small text-muted mb-0">
                                <i class="fas fa-check-circle text-primary-green"></i> ${property.features[2] || 'Feature 1'}
                            </div>
                            <div class="small text-muted mb-0">
                                <i class="fas fa-check-circle text-primary-green"></i> ${property.features[3] || 'Feature 2'}
                            </div>
                            <div class="small text-muted mb-0">
                                <i class="fas fa-check-circle text-primary-green"></i> ${property.features[4] || 'Feature 3'}
                            </div>
                            <div class="highlight-bar"></div> <!-- Added the green highlight bar -->
                        </div>
                        <div class="result-price-col">
                            <div>
                                <span class="rating-badge-list-view">${property.rating}</span> <!-- Badge for list view, inside price-col -->
                                <p class="mb-0 small text-muted text-end">${reviewText}</p>
                                <p class="mb-0 small text-muted text-end">${property.reviews} reviews</p>
                                <p class="mb-2 small text-muted text-end">1 night, ${adultsCount} adult${adultsCount !== 1 ? 's' : ''}</p>
                                <span class="price h4 font-weight-bold text-end d-block">LKR ${property.price.toLocaleString('en-US')}</span>
                                <p class="taxes small text-muted mb-0 text-end">Includes taxes and fees</p>
                            </div>
                            <button class="btn-see">
                                See availability <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    `;
                    resultsContainer.appendChild(card);

                    // Attach wishlist button listener - now only local state management
                    const wishlistBtn = card.querySelector('.wishlist-btn');
                    wishlistBtn.addEventListener('click', function() {
                        const propId = parseInt(this.dataset.id);
                        if (wishlistItems.includes(propId)) {
                            wishlistItems = wishlistItems.filter(id => id !== propId);
                        } else {
                            wishlistItems.push(propId);
                        }
                        // Update visual state locally
                        this.classList.toggle('added-to-wishlist', wishlistItems.includes(propId));
                        this.querySelector('i').classList.toggle('far', !wishlistItems.includes(propId));
                        this.querySelector('i').classList.toggle('fas', wishlistItems.includes(propId));
                        console.log("Current wishlist (local):", wishlistItems);
                    });

                    // Insert offer card after the 2nd result OR insert ads randomly
                    if (index === 1 && properties.length > 2) { // Insert offer after 2nd card (index 1)
                        const offerDiv = document.createElement('div');
                        offerDiv.innerHTML = offerCardHTML;
                        resultsContainer.appendChild(offerDiv);
                    } else if ((index + 1) % 4 === 0 && adCounter < adImages.length) { // Insert ad every 4 properties
                        const adCard = document.createElement('div');
                        adCard.classList.add('result-card', 'ad-card'); // Add 'ad-card' for specific styling if needed
                        // Ad cards don't need wishlist button or rating badge
                        adCard.innerHTML = `
                            <div class="result-image-col">
                                <img src="${adImages[adIndex % adImages.length]}" alt="Advertisement">
                            </div>
                            <div class="result-info-col text-center d-flex flex-column justify-content-center">
                                <h5 class="my-2 text-primary-green">Special Advertisement!</h5>
                                <p class="small text-muted">Discover amazing deals and eco-friendly trips.</p>
                                <button class="btn-see mt-2 mx-auto">Learn More</button>
                            </div>
                        `;
                        resultsContainer.appendChild(adCard);
                        adCounter++;
                        adIndex++;
                    }
                });

                // If no results, or if there's only one and offer wasn't placed, place it at end
                if (properties.length === 0 || (properties.length <= 2 && resultsContainer.querySelector('.offers-card') === null)) {
                    const offerDiv = document.createElement('div');
                    offerDiv.innerHTML = offerCardHTML;
                    resultsContainer.appendChild(offerDiv);
                }


                // Re-apply current view mode after rendering
                if (gridButton.classList.contains('active')) {
                    resultsContainer.classList.add('grid-view');
                    resultsContainer.classList.remove('list-view');
                } else {
                    resultsContainer.classList.remove('grid-view');
                    resultsContainer.classList.add('list-view');
                }
            }


            // Function to apply filters
            function applyFilters() {
                const currentAdults = parseInt(adultsQuantitySpan.textContent);
                const currentChildren = parseInt(childrenQuantitySpan.textContent);
                const currentBedrooms = parseInt(bedroomsQuantitySpan.textContent);
                const currentBathrooms = parseInt(bathroomsQuantitySpan.textContent);

                const queryLocation = locationInput.value.toLowerCase().trim();
                const selectedBudgetMin = parseInt(budgetSliderMin.value);
                const selectedBudgetMax = parseInt(budgetSliderMax.value);

                const selectedMeals = Array.from(document.querySelectorAll('#filterContentMeals input[type="checkbox"]:checked')).map(cb => cb.value);
                const selectedPropertyTypes = Array.from(document.querySelectorAll('#filterContentType input[type="checkbox"]:checked')).map(cb => cb.value);
                const selectedActivities = Array.from(document.querySelectorAll('#filterContentActivity input[type="checkbox"]:checked')).map(cb => cb.value);
                const selectedFacilities = Array.from(document.querySelectorAll('#filterContentFacilities input[type="checkbox"]:checked')).map(cb => cb.value);
                const selectedPolicy = Array.from(document.querySelectorAll('#filterContentPolicy input[type="checkbox"]:checked')).map(cb => cb.value);
                const selectedGroup = Array.from(document.querySelectorAll('#filterContentGroup input[type="checkbox"]:checked')).map(cb => cb.value);
                const selectedRating = parseFloat(document.querySelector('#filterContentRating input[type="radio"]:checked').value);

                // Deals filter
                const activeDealFilters = Array.from(document.querySelectorAll('#filterContentDeals input[type="checkbox"]:checked')).map(cb => cb.value);
                const anyDealFilterActive = activeDealFilters.length > 0;

                const isEntireHomeChecked = entireHomeCheckbox.checked;


                const filteredProperties = allProperties.filter(property => {
                    // Location filter
                    const matchesLocation = queryLocation === "" || property.location.toLowerCase().includes(queryLocation);

                    // Budget filter
                    const matchesBudget = property.price >= selectedBudgetMin && property.price <= selectedBudgetMax;

                    // Entire home checkbox filter (if checked, show only specified types)
                    const matchesEntireHome = !isEntireHomeChecked || ["Apartment", "Villa", "Guesthouse", "Hostel"].includes(property.type) || (isEntireHomeChecked && property.type === "Hotel" && property.features.includes("Entire home")); // Adjusted logic for "Hotel" as an entire home

                    // Meals filter (all selected meals must be included in property.meals)
                    const matchesMeals = selectedMeals.length === 0 || selectedMeals.every(meal => property.meals.includes(meal));

                    // Property type filter (at least one selected type must match property.type)
                    const matchesPropertyType = selectedPropertyTypes.length === 0 || selectedPropertyTypes.includes(property.type);

                    // Bedrooms & Bathrooms filter (property must have at least the selected number)
                    const matchesBedrooms = property.bedrooms >= currentBedrooms;
                    const matchesBathrooms = property.bathrooms >= currentBathrooms;

                    // Activity filter (at least one selected activity must match property.activity)
                    const matchesActivity = selectedActivities.length === 0 || selectedActivities.some(activity => property.activity.includes(activity));

                    // Property rating filter (property rating must be >= selected rating)
                    const matchesRating = selectedRating === 0 || property.rating >= selectedRating;

                    // Facilities filter (ALL selected facilities must be included in property.facilities)
                    const matchesFacilities = selectedFacilities.length === 0 || selectedFacilities.every(facility => property.facilities.includes(facility));

                    // Reservation policy filter (ALL selected policies must be included in property.policy)
                    const matchesPolicy = selectedPolicy.length === 0 || selectedPolicy.every(policy => property.policy.includes(policy));

                    // Travel group filter (at least one selected group must match property.group)
                    const matchesGroup = selectedGroup.length === 0 || selectedGroup.some(group => property.group.includes(group));

                    // Deal filter logic: If any deal checkbox is checked, the property must have at least one of the active deal types.
                    const matchesDeals = !anyDealFilterActive || activeDealFilters.some(dealType => property.deal.includes(dealType));


                    return matchesLocation && matchesBudget && matchesEntireHome && matchesMeals &&
                           matchesPropertyType && matchesBedrooms && matchesBathrooms && matchesActivity &&
                           matchesRating && matchesFacilities && matchesPolicy && matchesGroup && matchesDeals;
                });

                renderProperties(filteredProperties);
            }

            // Event Listeners for filters
            document.querySelectorAll('.filter-section input[type="checkbox"], .filter-section input[type="radio"]').forEach(input => {
                input.addEventListener('change', applyFilters);
            });
        });
    </script>
</body>
</html>
